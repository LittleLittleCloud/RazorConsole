@namespace HTop.Components

@using RazorConsole.Components
@using Spectre.Console

<Columns>
    <Rows>
        @for (int i = 0; i < CpuCores.Count; i++)
        {
            var cpuIndex = i; // Capture for closure
            <Columns>
                <Markup Content="@($"{cpuIndex + 1,2}")" Foreground="@Color.Aqua" />
                <ProgressBar Percentage="@CpuCores[cpuIndex]" Length="25" />
                <Markup Content="@($"{CpuCores[cpuIndex],5:F1}%")" Foreground="@Color.Grey70" />
            </Columns>
        }
        <Columns>
            <Markup Content="Mem" Foreground="@Color.Aqua" />
            <ProgressBar Percentage="@((double)UsedMemoryMB / TotalMemoryMB * 100)" Length="25" />
            <Markup Content="@($"{UsedMemoryMB,4}/{TotalMemoryMB}MB")" Foreground="@Color.Grey70" />
        </Columns>
        <Columns>
            <Markup Content="Swp" Foreground="@Color.Aqua" />
            <ProgressBar Percentage="@(SwapTotalMB > 0 ? (double)SwapUsedMB / SwapTotalMB * 100 : 0)" Length="25" />
            <Markup Content="@($"{SwapUsedMB,4}/{SwapTotalMB}MB")" Foreground="@Color.Grey70" />
        </Columns>
    </Rows>
    <Rows>

        <Markup Content="@($"Tasks: {ProcessCount}, {RunningCount} thr; {RunningProcesses} running")" Foreground="@Color.Aqua" />
        <Markup Content="@($"Load average: {LoadAverage}")" Foreground="@Color.Aqua" />
        <Markup Content="@($"Uptime: {Uptime}")" Foreground="@Color.Aqua" />
    </Rows>
</Columns>

@code {
    [Parameter]
    public List<double> CpuCores { get; set; } = new();

    [Parameter]
    public long UsedMemoryMB { get; set; }

    [Parameter]
    public long TotalMemoryMB { get; set; }

    [Parameter]
    public long SwapUsedMB { get; set; }

    [Parameter]
    public long SwapTotalMB { get; set; }

    [Parameter]
    public int ProcessCount { get; set; }

    [Parameter]
    public int RunningCount { get; set; }

    [Parameter]
    public int RunningProcesses { get; set; }

    [Parameter]
    public string LoadAverage { get; set; } = string.Empty;

    [Parameter]
    public string Uptime { get; set; } = string.Empty;


}
