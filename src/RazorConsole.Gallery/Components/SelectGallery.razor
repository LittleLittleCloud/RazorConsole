@using System.Threading.Tasks
@using RazorConsole.Components
@using Spectre.Console

<Padder Padding="@_outerPadding">
    <Rows>
        <Markup Content="Select shows a focusable dropdown with keyboard navigation, callbacks for changes, and styling hooks for each option." Foreground="@Color.Grey70" />
        <Newline />
        <Markup Content="Example" Decoration="@Decoration.Bold" />
        <Padder Padding="@_examplePadding">
            <Rows>
                <Select Options="@_componentOptions"
                        Placeholder="Choose a component"
                        Value="@_selected"
                        ValueChanged="OnValueChangedAsync"
                        OnSelected="OnSelectedAsync"
                        OnClear="OnClearedAsync"
                        Expand="true" />
                <Markup Content="@_status" Foreground="@_statusColor" Decoration="@_statusDecoration" />
            </Rows>
        </Padder>
        <Newline />
        <Markup Content="Code Example" Decoration="@Decoration.Bold" />
        <Padder Padding="@_codeExamplePadding">
            <Rows>
                <Markup Content="@CodeExampleLine1" Foreground="@Color.DeepSkyBlue1" />
                <Markup Content="@CodeExampleLine2" Foreground="@Color.Grey70" />
                <Markup Content="@CodeExampleLine3" Foreground="@Color.Grey70" />
                <Markup Content="@CodeExampleLine4" Foreground="@Color.Grey70" />
                <Markup Content="@CodeExampleLine5" Foreground="@Color.DeepSkyBlue1" />
            </Rows>
        </Padder>
        <Newline />
        <Markup Content="Source Code: Select.razor" Foreground="@Color.DeepSkyBlue1" Decoration="@Decoration.Underline" link="@DocumentationUrl" />
    </Rows>
</Padder>

@code {
    private static readonly Padding _outerPadding = new(1, 1, 1, 1);
    private static readonly Padding _examplePadding = new(0, 1, 0, 0);
    private static readonly Padding _codeExamplePadding = new(0, 1, 0, 0);

    private readonly string[] _componentOptions = new[]
    {
        "Align",
        "Border",
        "Columns",
        "Panel",
        "Select",
        "Text Input",
    };

    private string? _selected;
    private string _status = "Choose a component to inspect.";
    private Color _statusColor = Color.Grey70;
    private Decoration _statusDecoration = Decoration.Italic;

    private Task OnValueChangedAsync(string? value)
    {
        _selected = value;
        UpdateStatus(value, Color.DeepSkyBlue1, Decoration.None, "Highlighted");
        StateHasChanged();
        return Task.CompletedTask;
    }

    private Task OnSelectedAsync(string? value)
    {
        _selected = value;
        UpdateStatus(value, Color.Chartreuse1, Decoration.Bold, "Selected");
        StateHasChanged();
        return Task.CompletedTask;
    }

    private Task OnClearedAsync()
    {
        _selected = null;
        _status = "Selection cleared.";
        _statusColor = Color.Grey70;
        _statusDecoration = Decoration.Italic;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private void UpdateStatus(string? value, Color color, Decoration decoration, string prefix)
    {
        if (string.IsNullOrEmpty(value))
        {
            _status = "No component is selected.";
            _statusColor = Color.Grey70;
            _statusDecoration = Decoration.Italic;
            return;
        }

        _status = $"{prefix}: {value}.";
        _statusColor = color;
        _statusDecoration = decoration;
    }

    private const string CodeExampleLine1 = "<Select Options=\"@items\" Placeholder=\"Choose\" Value=\"@value\"";
    private const string CodeExampleLine2 = "        ValueChanged=\"OnValueChangedAsync\"";
    private const string CodeExampleLine3 = "        OnSelected=\"OnSelectedAsync\"";
    private const string CodeExampleLine4 = "        OnClear=\"OnClearedAsync\" Expand=\"true\" />";
    private const string CodeExampleLine5 = "<Markup Content=\"@status\" />";

    private const string DocumentationUrl = "https://github.com/LittleLittleCloud/RazorConsole/blob/main/src/RazorConsole.Core/Components/Select.razor";
}
