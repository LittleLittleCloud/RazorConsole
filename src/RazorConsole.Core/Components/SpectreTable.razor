@namespace RazorConsole.Components

@using System.Collections.Generic
@using System.Globalization
@using Microsoft.AspNetCore.Components
@using Spectre.Console

<table class="table"
	data-expand="@ExpandAttribute"
	data-width="@WidthAttribute"
	data-title="@TitleAttribute"
    data-border="@BorderAttribute"
    data-border-color="@BorderColorAttribute"
	data-show-headers="@ShowHeadersAttribute"
	@attributes="AdditionalAttributes">
    @ChildContent
</table>

@code {
    /// <summary>
    /// Renders a formatted table with rows, columns, headers, and optional borders.
    /// </summary>
    /// <remarks>
    /// Use this component with nested <see cref="SpectreTHead"/>, <see cref="SpectreTBody"/>,
    /// <see cref="SpectreTFoot"/>, <see cref="SpectreTR"/>, <see cref="SpectreTH"/>, and
    /// <see cref="SpectreTD"/> components to create structured tabular data displays.
    /// </remarks>

    /// <summary>
    /// Gets or sets the child content containing table rows and cells.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Gets or sets a value indicating whether the table should expand to fill available space.
    /// </summary>
    /// <remarks>
    /// Default is <c>false</c>.
    /// </remarks>
    [Parameter]
    public bool Expand { get; set; }

    /// <summary>
    /// Gets or sets the width of the table in characters.
    /// </summary>
    /// <remarks>
    /// If <c>null</c> or less than 1, the width is automatically determined by the content.
    /// </remarks>
    [Parameter]
    public int? Width { get; set; }

    /// <summary>
    /// Gets or sets the table title displayed above the table.
    /// </summary>
    /// <remarks>
    /// If <c>null</c> or whitespace, no title is displayed.
    /// </remarks>
    [Parameter]
    public string? Title { get; set; }

    /// <summary>
    /// Gets or sets the style of the table border.
    /// </summary>
    /// <remarks>
    /// If <c>null</c>, a default border is used. Options include <see cref="TableBorder.Rounded"/>,
    /// <see cref="TableBorder.Square"/>, <see cref="TableBorder.Minimal"/>, and others.
    /// </remarks>
    [Parameter]
    public TableBorder? Border { get; set; }

    /// <summary>
    /// Gets or sets the color of the table border.
    /// </summary>
    /// <remarks>
    /// Default is <see cref="Color.White"/>.
    /// </remarks>
    [Parameter]
    public Color BorderColor { get; set; } = Color.White;

    /// <summary>
    /// Gets or sets a value indicating whether table headers should be displayed.
    /// </summary>
    /// <remarks>
    /// Default is <c>true</c>.
    /// </remarks>
    [Parameter]
    public bool ShowHeaders { get; set; } = true;

    /// <summary>
    /// Gets or sets additional HTML attributes to apply to the table element.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public IReadOnlyDictionary<string, object?>? AdditionalAttributes { get; set; }

	private string ExpandAttribute => Expand ? "true" : "false";

	private string? WidthAttribute => Width.HasValue && Width.Value > 0
		? Width.Value.ToString(CultureInfo.InvariantCulture)
		: null;

	private string? TitleAttribute => string.IsNullOrWhiteSpace(Title) ? null : Title;

	private string? BorderAttribute => ToBorderAttribute(Border);

    private string BorderColorAttribute => BorderColor.ToHex();

	private static string? ToBorderAttribute(TableBorder? border)
	{
		if (border is null)
		{
			return null;
		}

		if (ReferenceEquals(border, TableBorder.Ascii))
		{
			return "ascii";
		}

		if (ReferenceEquals(border, TableBorder.Heavy))
		{
			return "heavy";
		}

		if (ReferenceEquals(border, TableBorder.Horizontal))
		{
			return "horizontal";
		}

		if (ReferenceEquals(border, TableBorder.Minimal))
		{
			return "minimal";
		}

		if (ReferenceEquals(border, TableBorder.MinimalDoubleHead))
		{
			return "minimaldoublehead";
		}

		if (ReferenceEquals(border, TableBorder.MinimalHeavyHead))
		{
			return "minimalheavyhead";
		}

		if (ReferenceEquals(border, TableBorder.Simple))
		{
			return "simple";
		}

		if (ReferenceEquals(border, TableBorder.SimpleHeavy))
		{
			return "simpleheavy";
		}

		if (ReferenceEquals(border, TableBorder.Square))
		{
			return "square";
		}

		if (ReferenceEquals(border, TableBorder.Double))
		{
			return "double";
		}

		if (ReferenceEquals(border, TableBorder.Rounded))
		{
			return "rounded";
		}

		if (ReferenceEquals(border, TableBorder.None))
		{
			return "none";
		}

		return null;
	}

	private string ShowHeadersAttribute => ShowHeaders ? "true" : "false";
}
