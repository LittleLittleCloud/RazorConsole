@namespace RazorConsole.Components

@using System.Collections.Generic
@using System.Globalization
@using Microsoft.AspNetCore.Components
@using RazorConsole.Core.Rendering.ComponentMarkup
@using Spectre.Console

<div class="panel"
     data-header="@TitleAttribute"
     data-header-color="@HeaderColorAttribute"
     data-border-color="@BorderColorAttribute"
     data-expand="@ExpandAttribute"
     data-border="@BorderAttribute"
     data-padding="@PaddingAttribute"
     data-height="@HeightAttribute"
     data-width="@WidthAttribute">
    @ChildContent
</div>

@code {
    /// <summary>
    /// Renders a panel with an optional title, border, and padding around child content.
    /// </summary>
    /// <remarks>
    /// Panels are useful for creating visual sections in your console application. They support
    /// customizable borders, titles, dimensions, and padding. For a simple border without a title,
    /// consider using the <see cref="Border"/> component instead.
    /// </remarks>

    /// <summary>
    /// Gets or sets the child content to be rendered inside the panel.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private static readonly IReadOnlyDictionary<BoxBorder, string> BorderNames = new Dictionary<BoxBorder, string>
{
        { BoxBorder.Square, "square" },
        { BoxBorder.Rounded, "rounded" },
        { BoxBorder.Double, "double" },
        { BoxBorder.Heavy, "heavy" },
        { BoxBorder.Ascii, "ascii" },
        { BoxBorder.None, "none" },
    };

    /// <summary>
    /// Gets or sets the title text displayed at the top of the panel border.
    /// </summary>
    /// <remarks>
    /// If <c>null</c> or whitespace, no title is displayed.
    /// </remarks>
    [Parameter]
    public string? Title { get; set; }

    /// <summary>
    /// Gets or sets the color of the panel title.
    /// </summary>
    /// <remarks>
    /// If <c>null</c>, the default console color is used.
    /// </remarks>
    [Parameter]
    public Color? TitleColor { get; set; }

    /// <summary>
    /// Gets or sets the color of the panel border.
    /// </summary>
    /// <remarks>
    /// If <c>null</c>, the default console color is used.
    /// </remarks>
    [Parameter]
    public Color? BorderColor { get; set; }

    /// <summary>
    /// Gets or sets the style of the panel border.
    /// </summary>
    /// <remarks>
    /// If <c>null</c>, a default border style is used. Common options include <see cref="BoxBorder.Rounded"/>,
    /// <see cref="BoxBorder.Square"/>, <see cref="BoxBorder.Double"/>, and <see cref="BoxBorder.None"/>.
    /// </remarks>
    [Parameter]
    public BoxBorder? Border { get; set; }

    /// <summary>
    /// Gets or sets the height of the panel in lines.
    /// </summary>
    /// <remarks>
    /// If <c>null</c> or less than 1, the height is automatically determined by the content.
    /// </remarks>
    [Parameter]
    public int? Height { get; set; }

    /// <summary>
    /// Gets or sets the padding inside the panel border.
    /// </summary>
    /// <remarks>
    /// If <c>null</c>, no padding is applied. Padding is specified as (left, top, right, bottom).
    /// </remarks>
    [Parameter]
    public Padding? Padding { get; set; }

    /// <summary>
    /// Gets or sets the width of the panel in characters.
    /// </summary>
    /// <remarks>
    /// If <c>null</c> or less than 1, the width is automatically determined by the content.
    /// </remarks>
    [Parameter]
    public int? Width { get; set; }

    /// <summary>
    /// Gets or sets a value indicating whether the panel should expand to fill available space.
    /// </summary>
    /// <remarks>
    /// Default is <c>false</c>.
    /// </remarks>
    [Parameter]
    public bool Expand { get; set; }

    private string? TitleAttribute => string.IsNullOrWhiteSpace(Title) ? null : Title;

    private string? HeaderColorAttribute => TitleColor?.ToMarkup();

    private string? BorderColorAttribute => BorderColor?.ToMarkup();

    private string? BorderAttribute
    {
        get
        {
            if (Border is null)
            {
                return null;
            }

            if (BorderNames.TryGetValue(Border, out var name))
            {
                return name;
            }

            return Border.GetType().Name.ToLowerInvariant();
        }
    }

    private string ExpandAttribute => Expand ? "true" : "false";

    private string? PaddingAttribute
    {
        get
        {
            if (Padding is not { } padding)
            {
                return null;
            }

            return string.Join(",",
                padding.Left.ToString(CultureInfo.InvariantCulture),
                padding.Top.ToString(CultureInfo.InvariantCulture),
                padding.Right.ToString(CultureInfo.InvariantCulture),
                padding.Bottom.ToString(CultureInfo.InvariantCulture));
        }
    }

    private string? HeightAttribute => Height.HasValue && Height.Value > 0
        ? Height.Value.ToString(CultureInfo.InvariantCulture)
        : null;

    private string? WidthAttribute => Width.HasValue && Width.Value > 0
        ? Width.Value.ToString(CultureInfo.InvariantCulture)
        : null;
}
